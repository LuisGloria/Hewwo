<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Desktop</title>
  <meta name="robots" content="noai, noimageai, nosnippet">

  <style>
    @font-face {
      font-family: 'LDRFont';
      src: url('../fonts/LDRFnt.ttf') format('truetype');
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: 'LDRFont', monospace;
      overflow: hidden;
      user-select: none;
    }

    .desktop {
      position: relative;
      width: 100vw;
      height: 100vh;
      padding: 20px;
    }

    .icon,
    .file-icon {
      width: auto;
      height: auto;
    }

    .icon img,
    .file-icon img {
      width: auto;
      height: auto;
      max-width: none;
      max-height: none;
      image-rendering: pixelated;
      display: block;
      margin: 0 auto;
    }


    .icon span {
      font-size: 12px;
      display: block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .icon:hover {
      outline: 1px dashed white;
    }

    .window {
      position: absolute;
      background: #000;
      border: 2px solid #fff;
      display: none;
      flex-direction: column;
      z-index: 100;
    }

    .window-header {
      height: 22px;
      line-height: 22px;
      padding: 0 6px;
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #fff;
      cursor: move;
      font-size: 13px;
    }

    .window-close {
      color: red;
      cursor: pointer;
    }

    .window-content {
      padding: 10px;
      background: black;
      font-size: 13px;
    }

    .window-content,
    .window-content pre {
      font-family: 'LDRFont', monospace;
    }

    .folder-view {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .file-icon {
      width: 72px;
      text-align: center;
      cursor: pointer;
    }

    .file-icon img {
      width: 48px;
      image-rendering: pixelated;
      display: block;
      margin: 0 auto 4px;
    }

    .viewer img {
      image-rendering: pixelated;
      max-width: none;
      display: block;
    }

    .terminal {
      background: #000;
      border: 1px solid #555;
      padding: 8px;
      font-size: 12px;
    }

    input {
      background: #000;
      color: white;
      border: 1px solid #555;
      font-family: inherit;
      font-size: 12px;
      padding: 2px 4px;
      width: 100%;
    }

    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 30px;
      background: #000;
      border-top: 2px solid #fff;
      display: flex;
      align-items: center;
      padding: 0 8px;
      z-index: 200;
    }

    #start-btn {
      font-family: 'LDRFont', monospace;
      font-size: 12px;
      background: #000;
      color: #fff;
      border: 1px solid #555;
      padding: 2px 6px;
      cursor: pointer;
    }

    #start-menu {
      display: none;
      position: absolute;
      bottom: 30px;
      left: 8px;
      background: #000;
      border: 2px solid #fff;
      min-width: 100px;
      font-family: 'LDRFont', monospace;
      font-size: 12px;
    }

    #boot-screen {
      position: fixed;
      inset: 0;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    #boot-image {
      image-rendering: pixelated;
      max-width: 100%;
      max-height: 100%;
    }


    .start-item {
      padding: 4px 8px;
      cursor: pointer;
    }

    .start-item:hover {
      background: #333;
    }
  </style>
</head>
<body>


<audio id="hdspin" src="../audio/hdspin.mp3" preload="auto"></audio>
<audio id="biosbeep" src="../audio/BIOSBEEP.mp3" preload="auto"></audio>
<audio id="biosbeep2" src="../audio/BIOSBEEP2.mp3" preload="auto"></audio>

<div id="boot-screen">
  <img id="boot-image" src="../img/hardcheck.gif">
</div>

<div class="desktop">

  <div class="icon" data-type="folder" style="position:absolute; top:20px; left:20px;">
    <img src="../img/folder1.png" alt="folder">
    <span>them</span>
  </div>

  <div class="icon" data-type="file" style="position:absolute; top:120px; left:20px;">
    <img src="../img/file.png" alt="file">
    <span>readme.txt</span>
  </div>

  <div class="icon" data-type="zip" style="position:absolute; top:220px; left:20px;">
    <img src="../img/zip.png" alt="zip">
    <span>archive.zip</span>
  </div>

  <div class="window" id="window">
    <div class="window-header" id="window-header">
      <span id="window-title">Window</span>
      <span class="window-close" id="window-close">X</span>
    </div>
    <div class="window-content" id="window-content"></div>
  </div>

</div>

<div class="taskbar">
  <button id="start-btn">Start</button>
  <div id="start-menu">
    <div class="start-item" id="shutdown">Shutdown</div>
  </div>
</div>

<script>
  // Updating this was pure h e l l
  const win = document.getElementById('window');
  const header = document.getElementById('window-header');
  const title = document.getElementById('window-title');
  const content = document.getElementById('window-content');
  const closeBtn = document.getElementById('window-close');
  const startBtn = document.getElementById('start-btn');
  const startMenu = document.getElementById('start-menu');
  const shutdown = document.getElementById('shutdown');
  const bootScreen = document.getElementById('boot-screen');
  const bootImage = document.getElementById('boot-image');
  const hdspin = document.getElementById('hdspin');
  const biosbeep = document.getElementById('biosbeep');
  const biosbeep2 = document.getElementById('biosbeep2');
  const files = [
  { id: 1, name: 'LOADER' },
  { id: 2, name: 'ZILO' },
  { id: 3, name: 'SINGET' },
  { id: 4, name: 'FX' },
  { id: 5, name: 'SID' },
  ];

  let bootStage = 0;
  let waitingEnter = false;

  function playFrameSequence(prefix, frameCount, frameDelay, onFinish) {
    let frame = 1;
    let finished = false;

    function nextFrame() {
      if (finished) return;

      bootImage.src = `${prefix}${frame}.png?t=${Date.now()}`;

      // Last frame, why do you force me to use === JavaScript?
      if (frame === frameCount) {
        finished = true;

        setTimeout(() => {
          onFinish?.();
        }, frameDelay);
        return;
      }
      frame++;
      setTimeout(nextFrame, frameDelay);
    }
    nextFrame();
  }

  function startBoot() {

    hdspin.play().catch(()=>{});
    playFrameSequence("../img/initframes/hardcheck_frames", 15, 2000, () => {

      bootImage.style.display = "none";
      biosbeep.play().catch(()=>{});

      setTimeout(() => {
        bootImage.style.display = "block";
        bootStage = 1;

        playFrameSequence("../img/initframes/initV_frames", 25, 1000, () => {

          bootStage = 2;
          waitingEnter = true;
          biosbeep2.play().catch(()=>{});

        });
      }, 2000);
    });
  }

  startBoot();

  document.addEventListener("keydown", e => {

    if (e.key !== "Enter") return;
    if (!waitingEnter) return;
    if (bootStage === 2) {

      waitingEnter = false;

      bootImage.style.display = "none";
      // Wait x seconds, remember to put actual code inside this time dumbass
      setTimeout(() => {

        bootImage.style.display = "block";
        bootImage.src = "../img/zLOGON.png";
        bootStage = 3;
        waitingEnter = true;

      }, 1000);
      return;
    }

    if (bootStage === 3) {
      waitingEnter = false;

      setTimeout(() => {
      bootScreen.remove();

      }, 1000);
      return;
    }
  });

  document.querySelectorAll('.icon').forEach(icon => {
    icon.addEventListener('dblclick', () => {
      openWindow(icon.dataset.type);
    });
  });

  function openWindow(type, payload = null) {
    win.style.display = 'flex';
    win.style.top = '120px';
    win.style.left = '160px';

    if (type === 'folder') {
      title.textContent = 'them';
      content.innerHTML = '<div class="folder-view"></div>';
      const view = content.querySelector('.folder-view');

      files.forEach(file => {
        const el = document.createElement('div');
        el.className = 'file-icon';
        el.innerHTML = `
          <img src="../img/file.png">
          <span>${file.name}</span>`;
        el.ondblclick = () => openWindow('image', file.id);
        view.appendChild(el);
      });
    }

    if (type === 'image') {
      title.textContent = `o${payload}.gif`;
      content.innerHTML = `
        <div class="viewer">
          <img src="../img/them/o${payload}.gif">
        </div>`;
    }

    if (type === 'file') {
      title.textContent = 'readme.txt';
      content.innerHTML = '<pre>LOADER here...\nFinally copied all important stuff here...This took hours.</pre>';
    }

    if (type === 'zip') { //stub, does nothing for now.
      title.textContent = 'Unzip File';
      content.innerHTML = `
        <div class="terminal">
          <p>Enter password:</p>
          <input type="password" id="zip-pass">
          <p id="zip-msg"></p>
        </div>`;

      const input = content.querySelector('#zip-pass');
      const msg = content.querySelector('#zip-msg');

      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') {
          msg.textContent = 'Access denied.';
          msg.style.color = 'red';
        }
      });
    }
  }

  closeBtn.addEventListener('click', () => {
    win.style.display = 'none';
  });

  let dragging = false, offX = 0, offY = 0;

  header.addEventListener('mousedown', e => {
    dragging = true;
    offX = e.clientX - win.offsetLeft;
    offY = e.clientY - win.offsetTop;
  });

  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    win.style.left = (e.clientX - offX) + 'px';
    win.style.top  = (e.clientY - offY) + 'px';
  });

  document.addEventListener('mouseup', () => dragging = false);

  startBtn.addEventListener('click', () => {
    startMenu.style.display = startMenu.style.display === 'block' ? 'none' : 'block';
  });

  shutdown.addEventListener('click', () => {
    window.location.href = '../index.html';
  });

  document.addEventListener('click', (e) => {
    if (!startBtn.contains(e.target) && !startMenu.contains(e.target)) {
      startMenu.style.display = 'none';
    }
  });
  // Damn...453 lines for a single html file? Ik this is HTML + CSS + JS in a single file, but damn!
</script>
</body>
</html>
